
 <!DOCTYPE HTML>
<html lang="java javascript">
<head>
  <meta charset="UTF-8">
  
    <title>Java从头学之Net | echo home</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="yhyecho">
    

    
    <meta name="description" content="网络编程一. 网络相关概念 网络: 将不同区域的计算机连接到一起。有局域网、城域网、互联网 地址: IP地址, 确定网络上一个绝对地址(位置) -&amp;gt; 房子 端口号: 区分计算机软件的 -&amp;gt; 房子的房门2个字节(0-65535) 在同一个协议下 端口号不能重复, 不同协议下可以重复 1024以下的端口号不要使用(80 -&amp;gt; http, 21 -&amp;gt; ftp)   资源定位: U">
<meta property="og:type" content="article">
<meta property="og:title" content="Java从头学之Net">
<meta property="og:url" content="http://www.yhyecho.com/2016/08/30/Java从头学之Net/index.html">
<meta property="og:site_name" content="echo home">
<meta property="og:description" content="网络编程一. 网络相关概念 网络: 将不同区域的计算机连接到一起。有局域网、城域网、互联网 地址: IP地址, 确定网络上一个绝对地址(位置) -&amp;gt; 房子 端口号: 区分计算机软件的 -&amp;gt; 房子的房门2个字节(0-65535) 在同一个协议下 端口号不能重复, 不同协议下可以重复 1024以下的端口号不要使用(80 -&amp;gt; http, 21 -&amp;gt; ftp)   资源定位: U">
<meta property="og:locale" content="java javascript">
<meta property="og:updated_time" content="2018-01-03T01:17:23.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java从头学之Net">
<meta name="twitter:description" content="网络编程一. 网络相关概念 网络: 将不同区域的计算机连接到一起。有局域网、城域网、互联网 地址: IP地址, 确定网络上一个绝对地址(位置) -&amp;gt; 房子 端口号: 区分计算机软件的 -&amp;gt; 房子的房门2个字节(0-65535) 在同一个协议下 端口号不能重复, 不同协议下可以重复 1024以下的端口号不要使用(80 -&amp;gt; http, 21 -&amp;gt; ftp)   资源定位: U">

    
    
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="echo home">echo home</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:www.yhyecho.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/08/30/Java从头学之Net/" title="Java从头学之Net" itemprop="url">Java从头学之Net</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="yhyecho" target="_blank" itemprop="author">yhyecho</a>
		
  <p class="article-time">
    <time datetime="2016-08-30T12:13:12.000Z" itemprop="datePublished"> 发表于 2016-08-30</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#网络编程"><span class="toc-number">1.</span> <span class="toc-text">网络编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#一-网络相关概念"><span class="toc-number">1.0.1.</span> <span class="toc-text">一. 网络相关概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#一-java中相关类"><span class="toc-number">1.0.2.</span> <span class="toc-text">一. java中相关类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（InetAddress、InetSocketAddress）"><span class="toc-number">1.0.3.</span> <span class="toc-text">网络编程（InetAddress、InetSocketAddress）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（URL、爬虫原理）"><span class="toc-number">1.0.4.</span> <span class="toc-text">网络编程（URL、爬虫原理）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（UDP编程、原理）"><span class="toc-number">1.0.5.</span> <span class="toc-text">网络编程（UDP编程、原理）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（UDP编程、发送类型、CS与BS区别）"><span class="toc-number">1.0.6.</span> <span class="toc-text">网络编程（UDP编程、发送类型、CS与BS区别）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（TCP、Socket通信、原理）"><span class="toc-number">1.0.7.</span> <span class="toc-text">网络编程（TCP、Socket通信、原理）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（TCP、Socket通信、多个客户端、聊天室原理）"><span class="toc-number">1.0.8.</span> <span class="toc-text">网络编程（TCP、Socket通信、多个客户端、聊天室原理）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（TCP、Socket通信、聊天室、客户端多线程）"><span class="toc-number">1.0.9.</span> <span class="toc-text">网络编程（TCP、Socket通信、聊天室、客户端多线程）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（TCP、Socket通信、聊天室、群聊）"><span class="toc-number">1.0.10.</span> <span class="toc-text">网络编程（TCP、Socket通信、聊天室、群聊）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（TCP、Socket通信、聊天室、私聊实现）"><span class="toc-number">1.0.11.</span> <span class="toc-text">网络编程（TCP、Socket通信、聊天室、私聊实现）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之Socket入门"><span class="toc-number">1.0.12.</span> <span class="toc-text">手写HttpServer服务器之Socket入门</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之HTML"><span class="toc-number">1.0.13.</span> <span class="toc-text">手写HttpServer服务器之HTML</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之Http协议"><span class="toc-number">1.0.14.</span> <span class="toc-text">手写HttpServer服务器之Http协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之封装Response"><span class="toc-number">1.0.15.</span> <span class="toc-text">手写HttpServer服务器之封装Response</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之封装Request（method、url）"><span class="toc-number">1.0.16.</span> <span class="toc-text">手写HttpServer服务器之封装Request（method、url）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之封装Request（储存参数、处理中文）"><span class="toc-number">1.0.17.</span> <span class="toc-text">手写HttpServer服务器之封装Request（储存参数、处理中文）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之封装分发器"><span class="toc-number">1.0.18.</span> <span class="toc-text">手写HttpServer服务器之封装分发器</span></a></li></ol></li></ol></li></ol>
		
		</div>
		
		<h2 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程"></a>网络编程</h2><h4 id="一-网络相关概念"><a href="#一-网络相关概念" class="headerlink" title="一. 网络相关概念"></a>一. 网络相关概念</h4><ol>
<li>网络: 将不同区域的计算机连接到一起。有局域网、城域网、互联网</li>
<li>地址: IP地址, 确定网络上一个绝对地址(位置) -&gt; 房子</li>
<li>端口号: 区分计算机软件的 -&gt; 房子的房门2个字节(0-65535)<ol>
<li>在同一个协议下 端口号不能重复, 不同协议下可以重复</li>
<li>1024以下的端口号不要使用(80 -&gt; http, 21 -&gt; ftp)</li>
</ol>
</li>
<li>资源定位: URL:统一资源定位符 URI:统一资源</li>
<li>数据的传输<ol>
<li>协议: TCP和UDP协议<ul>
<li>TCP: 类似于电话, 三次握手, 面向连接、安全可靠、效率低</li>
<li>UDP: 类似于短信, 非面向连接、数据可能丢失、效率高</li>
</ul>
</li>
<li>传输<ul>
<li>先封装</li>
<li>后拆封</li>
</ul>
</li>
</ol>
</li>
</ol>
<blockquote>
<p>TCP/IP 参考模型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">应用层(应用层、表示层、会话层)</div><div class="line">传输层(TCP/UDP)</div><div class="line">网络层(IP)</div><div class="line">物理+数据链路层(数据链路层、物理层)</div></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="一-java中相关类"><a href="#一-java中相关类" class="headerlink" title="一. java中相关类"></a>一. java中相关类</h4><ul>
<li>InetAddress (封装计算机的ip地址和DNS, 没有端口号)</li>
<li>InetSocketAddress (封装了端口号)</li>
<li>URL</li>
<li>TCP: <ul>
<li>ServerSocket </li>
<li>Socket</li>
</ul>
</li>
<li>UDP: <ul>
<li>DatagramSocket </li>
<li>DatagramPacket</li>
</ul>
</li>
</ul>
<h4 id="网络编程（InetAddress、InetSocketAddress）"><a href="#网络编程（InetAddress、InetSocketAddress）" class="headerlink" title="网络编程（InetAddress、InetSocketAddress）"></a>网络编程（InetAddress、InetSocketAddress）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.net.InetAddress;</div><div class="line"><span class="keyword">import</span> java.net.UnknownHostException;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 网络编程（InetAddress、InetSocketAddress）</span></div><div class="line"><span class="comment"> * InetAddress.getLocalHost()</span></div><div class="line"><span class="comment"> *  getHostAddress()</span></div><div class="line"><span class="comment"> *  getHostName()</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</div><div class="line">        InetAddress localHost = InetAddress.getLocalHost();</div><div class="line">        <span class="comment">// 获取ip地址</span></div><div class="line">        System.out.println(localHost.getHostAddress());</div><div class="line">        <span class="comment">// 获取主机名称</span></div><div class="line">        System.out.println(localHost.getHostName());</div><div class="line"></div><div class="line">        InetAddress addr = InetAddress.getByName(<span class="string">"www.163.com"</span>);</div><div class="line">        <span class="comment">// 获取域名对应的ip</span></div><div class="line">        System.out.println(addr.getHostAddress());</div><div class="line">        <span class="comment">// 获取主机名</span></div><div class="line">        System.out.println(addr.getHostName());</div><div class="line"></div><div class="line">        addr = InetAddress.getByName(<span class="string">"221.230.143.101"</span>);</div><div class="line">        System.out.println(addr.getHostAddress());</div><div class="line">        System.out.println(addr.getHostName());</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.net.InetAddress;</div><div class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * InetSocketAddress</span></div><div class="line"><span class="comment"> * getPort()</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        InetSocketAddress address = <span class="keyword">new</span> InetSocketAddress(<span class="string">"localhost"</span>, <span class="number">9999</span>);</div><div class="line"></div><div class="line">        System.out.println(address.getHostName());</div><div class="line">        System.out.println(address.getPort());</div><div class="line">        InetAddress add = address.getAddress();</div><div class="line">        System.out.println(add.getHostAddress()); <span class="comment">// 返回地址</span></div><div class="line">        System.out.println(add.getHostName()); <span class="comment">// 返回计算机名</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="网络编程（URL、爬虫原理）"><a href="#网络编程（URL、爬虫原理）" class="headerlink" title="网络编程（URL、爬虫原理）"></a>网络编程（URL、爬虫原理）</h4><blockquote>
<p>URL: 协议 + 域名 + 端口 + 资源名(<a href="http://www.google.com" target="_blank" rel="external">http://www.google.com</a>)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.net.MalformedURLException;</div><div class="line"><span class="keyword">import</span> java.net.URL;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 网络编程（URL、爬虫原理）</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MalformedURLException </span>&#123;</div><div class="line">        <span class="comment">// 1. 绝对路径构建</span></div><div class="line">        URL url = <span class="keyword">new</span> URL(<span class="string">"http://www.baidu.com:80/index.html#aa?uname=yhyecho"</span>); <span class="comment">// #aa 锚点</span></div><div class="line"></div><div class="line">        System.out.println(<span class="string">"锚点:"</span> + url.getRef());</div><div class="line">        url = <span class="keyword">new</span> URL(<span class="string">"http://www.baidu.com:80/a/"</span>);</div><div class="line">        <span class="comment">// 2. 相对路径</span></div><div class="line">        url = <span class="keyword">new</span> URL(url, <span class="string">"b.txt"</span>);</div><div class="line">        System.out.println(url.toString());</div><div class="line"></div><div class="line">        System.out.println(<span class="string">"协议:"</span> + url.getProtocol());</div><div class="line">        System.out.println(<span class="string">"域名:"</span> + url.getHost());</div><div class="line">        System.out.println(<span class="string">"端口:"</span> + url.getPort());</div><div class="line">        System.out.println(<span class="string">"资源:"</span> + url.getFile());</div><div class="line">        System.out.println(<span class="string">"相对路径:"</span> + url.getPath());</div><div class="line">        <span class="comment">// 参数: 存在锚点 返回null,</span></div><div class="line">        <span class="comment">//      不存在 返回正确</span></div><div class="line">        System.out.println(<span class="string">"参数:"</span> + url.getQuery());</div><div class="line"></div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"><span class="keyword">import</span> java.net.URL;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 获取资源</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        URL url = <span class="keyword">new</span> URL(<span class="string">"http://www.baidu.com"</span>); <span class="comment">// 主页 默认资源</span></div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// 获取资源 网络流</span></div><div class="line">        <span class="comment">//InputStream is = url.openStream();</span></div><div class="line">        <span class="comment">//byte[] flush = new byte[1024];</span></div><div class="line">        <span class="comment">//int len = 0;</span></div><div class="line">        <span class="comment">//while (-1 != (len = is.read(flush))) &#123;</span></div><div class="line">        <span class="comment">//    System.out.println(new String(flush, 0, len));</span></div><div class="line">        <span class="comment">//&#125;</span></div><div class="line">        <span class="comment">//is.close();</span></div><div class="line"></div><div class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(url.openStream(), <span class="string">"utf-8"</span>));</div><div class="line">        BufferedWriter bw = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(<span class="keyword">new</span> FileOutputStream(<span class="string">"baidu.html"</span>), <span class="string">"utf-8"</span>));</div><div class="line">        String msg = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">while</span> ((msg = br.readLine()) != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">//System.out.println(msg);</span></div><div class="line">            bw.append(msg);</div><div class="line">            bw.newLine();</div><div class="line">        &#125;</div><div class="line">        bw.flush();</div><div class="line">        bw.close();</div><div class="line">        br.close();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="网络编程（UDP编程、原理）"><a href="#网络编程（UDP编程、原理）" class="headerlink" title="网络编程（UDP编程、原理）"></a>网络编程（UDP编程、原理）</h4><blockquote>
<p>UDP: 以数据为中心，非面向连接，不安全 数据可能丢失 效率高</p>
<ul>
<li>类<ul>
<li>DatagramSocket</li>
<li>DatagramPacket</li>
</ul>
</li>
</ul>
<ol>
<li>客户端<ul>
<li>创建DatagramSocket类 + 指定端口</li>
<li>准备数据 字节数组</li>
<li>打包DatagramPacket + 服务器地址及端口</li>
<li>发送</li>
<li>释放资源</li>
</ul>
</li>
<li>服务器端<ul>
<li>创建DatagramSocket类 + 指定端口</li>
<li>准备接收的容器 字节数组 封装DatagramPacket</li>
<li>包 接收数据</li>
<li>分析</li>
<li>释放资源</li>
</ul>
</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.net.DatagramPacket;</div><div class="line"><span class="keyword">import</span> java.net.DatagramSocket;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 服务端</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="comment">// 1. 创建服务端+端口</span></div><div class="line">        DatagramSocket server = <span class="keyword">new</span> DatagramSocket(<span class="number">8888</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 2. 准备接收容器</span></div><div class="line">        <span class="keyword">byte</span>[] container = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">        <span class="comment">// 3. 封装成包</span></div><div class="line">        DatagramPacket packet = <span class="keyword">new</span> DatagramPacket(container, container.length);</div><div class="line">        <span class="comment">// 4. 接收数据</span></div><div class="line">        server.receive(packet);</div><div class="line">        <span class="comment">// 5. 分析数据</span></div><div class="line">        <span class="keyword">byte</span>[] data = packet.getData();</div><div class="line">        <span class="keyword">int</span> len = packet.getLength();</div><div class="line">        System.out.println(<span class="keyword">new</span> String(data, <span class="number">0</span>, len));</div><div class="line">        <span class="comment">// 6.释放资源</span></div><div class="line">        server.close();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.net.DatagramPacket;</div><div class="line"><span class="keyword">import</span> java.net.DatagramSocket;</div><div class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 客户端</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClient</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="comment">// 1. 创建服务器 + 端口</span></div><div class="line">        DatagramSocket client = <span class="keyword">new</span> DatagramSocket(<span class="number">6666</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 2. 准备数据</span></div><div class="line">        String msg = <span class="string">"udp编程"</span>;</div><div class="line">        <span class="keyword">byte</span>[] data = msg.getBytes();</div><div class="line"></div><div class="line">        <span class="comment">// 3. 打包</span></div><div class="line">        DatagramPacket packet = <span class="keyword">new</span> DatagramPacket(data, data.length, <span class="keyword">new</span> InetSocketAddress(<span class="string">"localhost"</span>, <span class="number">8888</span>));</div><div class="line">        <span class="comment">// 4. 发送数据</span></div><div class="line">        client.send(packet);</div><div class="line">        <span class="comment">// 5. 释放资源</span></div><div class="line">        client.close();</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="网络编程（UDP编程、发送类型、CS与BS区别）"><a href="#网络编程（UDP编程、发送类型、CS与BS区别）" class="headerlink" title="网络编程（UDP编程、发送类型、CS与BS区别）"></a>网络编程（UDP编程、发送类型、CS与BS区别）</h4><blockquote>
<p>发送带类型的数据 double num = 89.12;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 服务端</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="comment">// 1. 创建服务端+端口</span></div><div class="line">        DatagramSocket server = <span class="keyword">new</span> DatagramSocket(<span class="number">8888</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 2. 准备接收容器</span></div><div class="line">        <span class="keyword">byte</span>[] container = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">        <span class="comment">// 3. 封装成包</span></div><div class="line">        DatagramPacket packet = <span class="keyword">new</span> DatagramPacket(container, container.length);</div><div class="line">        <span class="comment">// 4. 接收数据</span></div><div class="line">        server.receive(packet);</div><div class="line">        <span class="comment">// 5. 分析数据</span></div><div class="line">        <span class="comment">// byte[] data = packet.getData();</span></div><div class="line">        <span class="keyword">double</span> data = convert(packet.getData());</div><div class="line">        <span class="keyword">int</span> len = packet.getLength();</div><div class="line">        <span class="comment">// System.out.println(new String(data, 0, len));</span></div><div class="line">        System.out.println(data);</div><div class="line">        <span class="comment">// 6.释放资源</span></div><div class="line">        server.close();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 字节数组 数据源 + Data输入流</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">convert</span><span class="params">(<span class="keyword">byte</span>[] data)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        DataInputStream dis = <span class="keyword">new</span> DataInputStream(<span class="keyword">new</span> ByteArrayInputStream(data));</div><div class="line">        <span class="keyword">double</span> num = dis.readDouble();</div><div class="line">        dis.close();</div><div class="line">        <span class="keyword">return</span> num;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 客户端</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="comment">// 1. 创建服务器 + 端口</span></div><div class="line">        DatagramSocket client = <span class="keyword">new</span> DatagramSocket(<span class="number">6666</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 2. 准备数据</span></div><div class="line">        String msg = <span class="string">"udp编程"</span>;</div><div class="line"></div><div class="line">        <span class="keyword">double</span> num = <span class="number">89.12</span>;</div><div class="line">        <span class="keyword">byte</span>[] data = convert(num);</div><div class="line">        <span class="comment">// byte[] data = msg.getBytes();</span></div><div class="line"></div><div class="line">        <span class="comment">// 3. 打包</span></div><div class="line">        DatagramPacket packet = <span class="keyword">new</span> DatagramPacket(data, data.length, <span class="keyword">new</span> InetSocketAddress(<span class="string">"localhost"</span>, <span class="number">8888</span>));</div><div class="line">        <span class="comment">// 4. 发送数据</span></div><div class="line">        client.send(packet);</div><div class="line">        <span class="comment">// 5. 释放资源</span></div><div class="line">        client.close();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 字节数组 数据源 + Data输出流</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> num</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] convert(<span class="keyword">double</span> num) <span class="keyword">throws</span> IOException &#123;</div><div class="line">        <span class="keyword">byte</span>[] data = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">        ByteArrayOutputStream bos = <span class="keyword">new</span> ByteArrayOutputStream();</div><div class="line">        DataOutputStream dos = <span class="keyword">new</span> DataOutputStream(bos);</div><div class="line">        dos.writeDouble(num);</div><div class="line">        dos.flush();</div><div class="line"></div><div class="line">        <span class="comment">// 获取数据</span></div><div class="line">        data = bos.toByteArray();</div><div class="line">        dos.close();</div><div class="line">        <span class="keyword">return</span> data;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="网络编程（TCP、Socket通信、原理）"><a href="#网络编程（TCP、Socket通信、原理）" class="headerlink" title="网络编程（TCP、Socket通信、原理）"></a>网络编程（TCP、Socket通信、原理）</h4><p>基于tcp: 面向连接 安全 可靠 效率低， 类似于打电话</p>
<ol>
<li>面向连接: 请求－响应 Request - Response</li>
<li>Socket编程<ul>
<li>服务器: ServerSocket</li>
<li>客户端: Socket</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketServer</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="comment">// 1. 创建服务端 + 指定端口</span></div><div class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 2. 接收客户端的连接 阻塞式</span></div><div class="line">        Socket socket = server.accept();</div><div class="line">        System.out.println(<span class="string">"一个客户端建立连接"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 3. 发送和接收数据</span></div><div class="line">        String msg = <span class="string">"欢迎使用"</span>;</div><div class="line">        <span class="comment">// 输出流</span></div><div class="line">        BufferedWriter bw = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(</div><div class="line">                socket.getOutputStream()</div><div class="line">        ));</div><div class="line">        bw.write(msg);</div><div class="line">        bw.newLine();</div><div class="line">        bw.flush();</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketClient</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="comment">// 1. 创建客户端: 指定服务器端 + 端口</span></div><div class="line">        Socket client = <span class="keyword">new</span> Socket(<span class="string">"localhost"</span>, <span class="number">8888</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 2. 接收数据</span></div><div class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(</div><div class="line">           client.getInputStream()</div><div class="line">        ));</div><div class="line"></div><div class="line">        String result = br.readLine();</div><div class="line">        System.out.println(result);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="网络编程（TCP、Socket通信、多个客户端、聊天室原理）"><a href="#网络编程（TCP、Socket通信、多个客户端、聊天室原理）" class="headerlink" title="网络编程（TCP、Socket通信、多个客户端、聊天室原理）"></a>网络编程（TCP、Socket通信、多个客户端、聊天室原理）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 创建服务器</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</div><div class="line">        Socket client = server.accept();</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// 写出数据</span></div><div class="line">        <span class="comment">// 输入流</span></div><div class="line">        DataInputStream dis = <span class="keyword">new</span> DataInputStream(client.getInputStream());</div><div class="line">        String msg = dis.readUTF();</div><div class="line"></div><div class="line">        <span class="comment">// 输出流</span></div><div class="line">        DataOutputStream dos = <span class="keyword">new</span> DataOutputStream(client.getOutputStream());</div><div class="line">        dos.writeUTF(<span class="string">"服务器--&gt;"</span> + msg);</div><div class="line">        dos.flush();</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 创建客户端: 发送数据 + 接收数据</span></div><div class="line"><span class="comment"> * 输入流与输出流在同一个线程內, 应该独立处理, 彼此独立</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        Socket client = <span class="keyword">new</span> Socket(<span class="string">"localhost"</span>, <span class="number">9999</span>);</div><div class="line">        <span class="comment">// 控制台输入流</span></div><div class="line">        BufferedReader console = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</div><div class="line"></div><div class="line">        String info = console.readLine();</div><div class="line">        <span class="comment">// 写出数据</span></div><div class="line">        DataOutputStream dos = <span class="keyword">new</span> DataOutputStream(client.getOutputStream());</div><div class="line">        dos.writeUTF(info);</div><div class="line">        dos.flush();</div><div class="line"></div><div class="line">        <span class="comment">// 读取数据</span></div><div class="line">        DataInputStream dis = <span class="keyword">new</span> DataInputStream(client.getInputStream());</div><div class="line">        String msg = dis.readUTF();</div><div class="line">        System.out.println(msg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="网络编程（TCP、Socket通信、聊天室、客户端多线程）"><a href="#网络编程（TCP、Socket通信、聊天室、客户端多线程）" class="headerlink" title="网络编程（TCP、Socket通信、聊天室、客户端多线程）"></a>网络编程（TCP、Socket通信、聊天室、客户端多线程）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.yhy.demo02;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.DataInputStream;</div><div class="line"><span class="keyword">import</span> java.io.DataOutputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.net.ServerSocket;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 创建服务器</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</div><div class="line">        Socket client = server.accept();</div><div class="line"></div><div class="line">        <span class="comment">// 写出数据</span></div><div class="line">        <span class="comment">// 输入流</span></div><div class="line">        DataInputStream dis = <span class="keyword">new</span> DataInputStream(client.getInputStream());</div><div class="line"></div><div class="line">        <span class="comment">// 输出流</span></div><div class="line">        DataOutputStream dos = <span class="keyword">new</span> DataOutputStream(client.getOutputStream());</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            String msg = dis.readUTF();</div><div class="line">            System.out.println(msg);</div><div class="line">            dos.writeUTF(<span class="string">"服务器--&gt;"</span> + msg);</div><div class="line">            dos.flush();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.yhy.demo02;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;</div><div class="line"><span class="keyword">import</span> java.io.DataOutputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStreamReader;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 发送数据 线程</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Send</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 控制台输入流</span></div><div class="line">    <span class="keyword">private</span> BufferedReader console;</div><div class="line">    <span class="comment">// 管道输出流</span></div><div class="line">    <span class="keyword">private</span> DataOutputStream dos;</div><div class="line">    <span class="comment">// 控制线程</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isRunning = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Send</span><span class="params">()</span> </span>&#123;</div><div class="line">        console = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Send</span><span class="params">(Socket client)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            dos = <span class="keyword">new</span> DataOutputStream(client.getOutputStream());</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            isRunning = <span class="keyword">false</span>;</div><div class="line">            CloseUtil.closeAll(dos, console);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 从控制台接收数据</span></div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getMsgFromConsole</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> console.readLine();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="string">""</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 1. 从控制台接收数据</span></div><div class="line"><span class="comment">     * 2. 发送数据</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</div><div class="line">        String msg = getMsgFromConsole();</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != msg &amp;&amp; !msg.equals(<span class="string">""</span>)) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                dos.writeUTF(msg);</div><div class="line">                dos.flush();</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                isRunning = <span class="keyword">false</span>;</div><div class="line">                CloseUtil.closeAll(dos, console);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (isRunning) &#123;</div><div class="line">            send();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.yhy.demo02;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.DataInputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 接收数据,线程</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Receive</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 输入流</span></div><div class="line">    <span class="keyword">private</span> DataInputStream dis;</div><div class="line">    <span class="comment">// 线程标示</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isRunning = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Receive</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Receive</span><span class="params">(Socket client)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            dis = <span class="keyword">new</span> DataInputStream(client.getInputStream());</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            isRunning = <span class="keyword">false</span>;</div><div class="line">            CloseUtil.closeAll(dis);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 接收数据</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</div><div class="line">        String msg = <span class="string">"232332"</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            msg = dis.readUTF();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            isRunning = <span class="keyword">false</span>;</div><div class="line">            CloseUtil.closeAll(dis);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> msg;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 线程体</span></div><div class="line">        <span class="keyword">while</span> (isRunning) &#123;</div><div class="line">            System.out.println(getMsg());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 创建客户端: 发送数据 + 接收数据</span></div><div class="line"><span class="comment"> * 输入流与输出流在同一个线程內, 应该独立处理, 彼此独立</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        Socket client = <span class="keyword">new</span> Socket(<span class="string">"localhost"</span>, <span class="number">9999</span>);</div><div class="line"></div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Send(client)).start(); <span class="comment">// 一条路径, 发送数据</span></div><div class="line"></div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Receive(client)).start(); <span class="comment">// 另一条路径</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 关闭流的方法</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CloseUtil</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeAll</span><span class="params">(Closeable ... io)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (Closeable temp: io) &#123;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != temp) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    temp.close();</div><div class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="网络编程（TCP、Socket通信、聊天室、群聊）"><a href="#网络编程（TCP、Socket通信、聊天室、群聊）" class="headerlink" title="网络编程（TCP、Socket通信、聊天室、群聊）"></a>网络编程（TCP、Socket通信、聊天室、群聊）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 创建服务器, 聊天信息转发</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;MyChannel&gt; all = <span class="keyword">new</span> ArrayList&lt;MyChannel&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="keyword">new</span> Server().start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</div><div class="line"></div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            Socket client = server.accept();</div><div class="line">            MyChannel channel = <span class="keyword">new</span> MyChannel(client);</div><div class="line">            all.add(channel); <span class="comment">// 统一管理道路</span></div><div class="line">            <span class="keyword">new</span> Thread(channel).start(); <span class="comment">// 一条道路</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 一个客户端一条道路</span></div><div class="line"><span class="comment">     * 1. 输入流</span></div><div class="line"><span class="comment">     * 2. 输出流</span></div><div class="line"><span class="comment">     * 3. 接收数据</span></div><div class="line"><span class="comment">     * 4. 发送数据</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyChannel</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> DataInputStream dis;</div><div class="line">        <span class="keyword">private</span> DataOutputStream dos;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isRunning = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyChannel</span><span class="params">(Socket client)</span> </span>&#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                dis = <span class="keyword">new</span> DataInputStream(client.getInputStream());</div><div class="line">                dos = <span class="keyword">new</span> DataOutputStream(client.getOutputStream());</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                isRunning = <span class="keyword">false</span>;</div><div class="line">                CloseUtil.closeAll(dis, dos);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 读取数据</span></div><div class="line"><span class="comment">         * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="function"><span class="keyword">private</span> String <span class="title">receive</span><span class="params">()</span> </span>&#123;</div><div class="line">            String msg = <span class="string">""</span>;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                msg = dis.readUTF();</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                isRunning = <span class="keyword">false</span>;</div><div class="line">                CloseUtil.closeAll(dis);</div><div class="line">                all.remove(<span class="keyword">this</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> msg;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         *</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == msg || msg.equals(<span class="string">""</span>)) &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                dos.writeUTF(msg);</div><div class="line">                dos.flush();</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                isRunning = <span class="keyword">false</span>;</div><div class="line">                CloseUtil.closeAll(dos);</div><div class="line">                all.remove(<span class="keyword">this</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 发送给其他客户端</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendOther</span><span class="params">()</span> </span>&#123;</div><div class="line">            String msg = receive();</div><div class="line">            <span class="comment">// 遍历容器</span></div><div class="line">            <span class="keyword">for</span> (MyChannel other : all) &#123;</div><div class="line">                <span class="keyword">if</span> (other == <span class="keyword">this</span>) &#123;</div><div class="line">                    <span class="keyword">continue</span>; <span class="comment">// 跳过自己</span></div><div class="line">                &#125;</div><div class="line">                <span class="comment">// 发送给其他客户端</span></div><div class="line">                other.send(msg);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">while</span> (isRunning) &#123;</div><div class="line">                sendOther();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="网络编程（TCP、Socket通信、聊天室、私聊实现）"><a href="#网络编程（TCP、Socket通信、聊天室、私聊实现）" class="headerlink" title="网络编程（TCP、Socket通信、聊天室、私聊实现）"></a>网络编程（TCP、Socket通信、聊天室、私聊实现）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.yhy.demo04;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.DataInputStream;</div><div class="line"><span class="keyword">import</span> java.io.DataOutputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.net.ServerSocket;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 创建服务器, 聊天信息转发</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;MyChannel&gt; all = <span class="keyword">new</span> ArrayList&lt;MyChannel&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="keyword">new</span> Server().start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        ServerSocket server = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);</div><div class="line"></div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            Socket client = server.accept();</div><div class="line">            MyChannel channel = <span class="keyword">new</span> MyChannel(client);</div><div class="line">            all.add(channel); <span class="comment">// 统一管理道路</span></div><div class="line">            <span class="keyword">new</span> Thread(channel).start(); <span class="comment">// 一条道路</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 一个客户端一条道路</span></div><div class="line"><span class="comment">     * 1. 输入流</span></div><div class="line"><span class="comment">     * 2. 输出流</span></div><div class="line"><span class="comment">     * 3. 接收数据</span></div><div class="line"><span class="comment">     * 4. 发送数据</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyChannel</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> DataInputStream dis;</div><div class="line">        <span class="keyword">private</span> DataOutputStream dos;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isRunning = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyChannel</span><span class="params">(Socket client)</span> </span>&#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                dis = <span class="keyword">new</span> DataInputStream(client.getInputStream());</div><div class="line">                dos = <span class="keyword">new</span> DataOutputStream(client.getOutputStream());</div><div class="line"></div><div class="line">                <span class="keyword">this</span>.name = dis.readUTF();</div><div class="line"></div><div class="line">                <span class="keyword">this</span>.send(<span class="string">"欢迎您进入聊天室"</span>);</div><div class="line">                sendOther(<span class="keyword">this</span>.name + <span class="string">"进入了聊天室"</span>, <span class="keyword">true</span>);</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                isRunning = <span class="keyword">false</span>;</div><div class="line">                CloseUtil.closeAll(dis, dos);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 读取数据</span></div><div class="line"><span class="comment">         *</span></div><div class="line"><span class="comment">         * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="function"><span class="keyword">private</span> String <span class="title">receive</span><span class="params">()</span> </span>&#123;</div><div class="line">            String msg = <span class="string">""</span>;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                msg = dis.readUTF();</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                isRunning = <span class="keyword">false</span>;</div><div class="line">                CloseUtil.closeAll(dis);</div><div class="line">                all.remove(<span class="keyword">this</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> msg;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         *</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == msg || msg.equals(<span class="string">""</span>)) &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                dos.writeUTF(msg);</div><div class="line">                dos.flush();</div><div class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                isRunning = <span class="keyword">false</span>;</div><div class="line">                CloseUtil.closeAll(dos);</div><div class="line">                all.remove(<span class="keyword">this</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 发送给其他客户端</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendOther</span><span class="params">(String msg, <span class="keyword">boolean</span> flag)</span> </span>&#123;</div><div class="line"></div><div class="line">            <span class="comment">// 是否为私聊</span></div><div class="line">            <span class="keyword">if</span> (msg.startsWith(<span class="string">"@"</span>) &amp;&amp; msg.indexOf(<span class="string">":"</span>) &gt; -<span class="number">1</span>) &#123; <span class="comment">// 私聊</span></div><div class="line">                <span class="comment">// 获取name</span></div><div class="line">                String name = msg.substring(<span class="number">1</span>, msg.indexOf(<span class="string">":"</span>));</div><div class="line">                String content = msg.substring(msg.indexOf(<span class="string">":"</span>) + <span class="number">1</span>);</div><div class="line">                <span class="keyword">for</span> (MyChannel other : all) &#123;</div><div class="line">                    <span class="keyword">if</span> (other.name.equals(name)) &#123;</div><div class="line">                        other.send(<span class="keyword">this</span>.name + <span class="string">"对你悄悄的说:"</span> + content);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// 遍历容器</span></div><div class="line">                <span class="keyword">for</span> (MyChannel other : all) &#123;</div><div class="line">                    <span class="keyword">if</span> (other == <span class="keyword">this</span>) &#123;</div><div class="line">                        <span class="keyword">continue</span>; <span class="comment">// 跳过自己</span></div><div class="line">                    &#125;</div><div class="line">                    <span class="comment">// 发送给其他客户端</span></div><div class="line">                    <span class="keyword">if</span> (flag) &#123;</div><div class="line">                        other.send(<span class="string">"系统消息:"</span> + msg);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        other.send(<span class="keyword">this</span>.name + <span class="string">"对所有人说:"</span> + msg);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">while</span> (isRunning) &#123;</div><div class="line">                sendOther(receive(), <span class="keyword">false</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        System.out.println(<span class="string">"请输入名称:"</span>);</div><div class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</div><div class="line"></div><div class="line">        String name = br.readLine();</div><div class="line">        <span class="keyword">if</span> (name.equals(<span class="string">""</span>)) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        Socket client = <span class="keyword">new</span> Socket(<span class="string">"localhost"</span>, <span class="number">9999</span>);</div><div class="line"></div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Send(client, name)).start(); <span class="comment">// 一条路径, 发送数据</span></div><div class="line"></div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Receive(client)).start(); <span class="comment">// 另一条路径</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="手写HttpServer服务器之Socket入门"><a href="#手写HttpServer服务器之Socket入门" class="headerlink" title="手写HttpServer服务器之Socket入门"></a>手写HttpServer服务器之Socket入门</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 创建服务器并启动</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> ServerSocket server;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Server server = <span class="keyword">new</span> Server();</div><div class="line">        server.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 启动方法</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            server = <span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</div><div class="line">            <span class="keyword">this</span>.receive();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 接收客户端</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Socket client = server.accept();</div><div class="line">            String msg = <span class="keyword">null</span>; <span class="comment">// 接收客户端的请求信息</span></div><div class="line">            BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(client.getInputStream()));</div><div class="line"></div><div class="line">            StringBuilder sb = <span class="keyword">new</span> StringBuilder();</div><div class="line">            <span class="keyword">while</span> ((msg = br.readLine()).length() &gt; <span class="number">0</span>) &#123;</div><div class="line">                sb.append(msg);</div><div class="line">                sb.append(<span class="string">"\r\n"</span>);</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> == msg) &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">// 接收客户端的请求信息</span></div><div class="line">            String receiveMsg = sb.toString().trim();</div><div class="line"></div><div class="line">            System.out.println(receiveMsg);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 停止服务器</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="手写HttpServer服务器之HTML"><a href="#手写HttpServer服务器之HTML" class="headerlink" title="手写HttpServer服务器之HTML"></a>手写HttpServer服务器之HTML</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>第一个html<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        显示正文信息</div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>段落<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>第一个表单<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">pre</span>&gt;</span></div><div class="line">            method: 请求方式 get/post</div><div class="line">                get: 数据量小， 安全性不高, 默认方式</div><div class="line">                post: 量大，安全性相对高</div><div class="line">            action: 请求的服务器路径</div><div class="line">            id: 编号, 前端区分唯一性, js使用</div><div class="line">            name: 名称， 后端（服务器区分唯一性), 获取值</div><div class="line">            只要提交数据给后台，必须存在name</div><div class="line">        <span class="tag">&lt;/<span class="name">pre</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">action</span>=<span class="string">"http://localhost:8888/index.html"</span>&gt;</span></div><div class="line">            用户名: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"uname"</span> <span class="attr">id</span>=<span class="string">"name"</span>&gt;</span></div><div class="line">            密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span> <span class="attr">id</span>=<span class="string">"pass"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登陆"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>post方式请求头信息<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">POST /index.html HTTP/1.1</div><div class="line">Host: localhost:8888</div><div class="line">Connection: keep-alive</div><div class="line">Content-Length: 21</div><div class="line">Cache-Control: max-age=0</div><div class="line">Upgrade-Insecure-Requests: 1</div><div class="line">Origin: null</div><div class="line">Content-Type: application/x-www-form-urlencoded</div><div class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.36</div><div class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</div><div class="line">Accept-Encoding: gzip, deflate, br</div><div class="line">Accept-Language: zh-CN,zh;q=0.9,zh-TW;q=0.8,en-US;q=0.7,en;q=0.6</div><div class="line">Cookie: Hm_lvt_e6d1f421bbc9962127a50488f9ed37d1=1508739098</div><div class="line"></div><div class="line">uname=sdfsdf&amp;pwd=2342</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 创建服务器并启动</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server2</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> ServerSocket server;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Server2 server = <span class="keyword">new</span> Server2();</div><div class="line">        server.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 启动方法</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            server = <span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</div><div class="line">            <span class="keyword">this</span>.receive();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 接收客户端</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Socket client = server.accept();</div><div class="line">            String msg = <span class="keyword">null</span>; <span class="comment">// 接收客户端的请求信息</span></div><div class="line"></div><div class="line">            <span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">20480</span>];</div><div class="line"></div><div class="line">            <span class="keyword">int</span> len = client.getInputStream().read(data);</div><div class="line"></div><div class="line"></div><div class="line">            <span class="comment">// 接收客户端的请求信息</span></div><div class="line">            String receiveMsg = <span class="keyword">new</span> String(data, <span class="number">0</span>, len).trim();</div><div class="line"></div><div class="line">            System.out.println(receiveMsg);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 停止服务器</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="手写HttpServer服务器之Http协议"><a href="#手写HttpServer服务器之Http协议" class="headerlink" title="手写HttpServer服务器之Http协议"></a>手写HttpServer服务器之Http协议</h4><ul>
<li><p>post方式请求头信息</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">POST /index.html HTTP/1.1</div><div class="line">Host: localhost:8888</div><div class="line">Connection: keep-alive</div><div class="line">Content-Length: 21</div><div class="line">Cache-Control: max-age=0</div><div class="line">Upgrade-Insecure-Requests: 1</div><div class="line">Origin: null</div><div class="line">Content-Type: application/x-www-form-urlencoded</div><div class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.36</div><div class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</div><div class="line">Accept-Encoding: gzip, deflate, br</div><div class="line">Accept-Language: zh-CN,zh;q=0.9,zh-TW;q=0.8,en-US;q=0.7,en;q=0.6</div><div class="line">Cookie: Hm_lvt_e6d1f421bbc9962127a50488f9ed37d1=1508739098</div><div class="line"></div><div class="line">uname=sdfsdf&amp;pwd=2342</div></pre></td></tr></table></figure>
</li>
<li><p>HTTP请求格式, 请求由3部分构成 分别是</p>
<ul>
<li>请求方式, URI(统一资源定位符), HTTP协议/版本</li>
<li>请求头(Request Header)</li>
<li>请求正文(Request Content) // post提交才有</li>
</ul>
</li>
<li>HTTP响应格式, 由3部分构成 分别是<ul>
<li>HTTP协议版本，状态代码，描述</li>
<li>响应头(Response Header)</li>
<li>响应正文(Response Content)<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 请求并响应</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server3</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> ServerSocket server;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CRLF = <span class="string">"\r\n"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String BLANK = <span class="string">" "</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Server3 server = <span class="keyword">new</span> Server3();</div><div class="line">        server.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 启动方法</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            server = <span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</div><div class="line">            <span class="keyword">this</span>.receive();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 接收客户端</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Socket client = server.accept();</div><div class="line">            String msg = <span class="keyword">null</span>; <span class="comment">// 接收客户端的请求信息</span></div><div class="line"></div><div class="line">            <span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">20480</span>];</div><div class="line"></div><div class="line">            <span class="keyword">int</span> len = client.getInputStream().read(data);</div><div class="line"></div><div class="line"></div><div class="line">            <span class="comment">// 接收客户端的请求信息</span></div><div class="line">            String receiveMsg = <span class="keyword">new</span> String(data, <span class="number">0</span>, len).trim();</div><div class="line"></div><div class="line">            System.out.println(receiveMsg);</div><div class="line"></div><div class="line"></div><div class="line">            StringBuilder responseContent = <span class="keyword">new</span> StringBuilder();</div><div class="line">            responseContent.append(<span class="string">"&lt;html&gt;\n"</span> +</div><div class="line">                    <span class="string">"    &lt;head&gt;\n"</span> +</div><div class="line">                    <span class="string">"        &lt;title&gt;第一个html&lt;/title&gt;\n"</span> +</div><div class="line">                    <span class="string">"    &lt;/head&gt;\n"</span> +</div><div class="line">                    <span class="string">"    &lt;body&gt;\n"</span> +</div><div class="line">                    <span class="string">"        Hello YhyEcho\n"</span> +</div><div class="line">                    <span class="string">"    &lt;/body&gt;\n"</span> +</div><div class="line">                    <span class="string">"&lt;/html&gt;"</span>);</div><div class="line"></div><div class="line">            StringBuilder response = <span class="keyword">new</span> StringBuilder();</div><div class="line"></div><div class="line">            <span class="comment">// 1. HTTP协议版本，状态代码，描述</span></div><div class="line">            response.append(<span class="string">"HTTP/1.1"</span>).append(BLANK).append(<span class="string">"200"</span>).append(BLANK).append(CRLF);</div><div class="line">            <span class="comment">// 2. 响应头(Response Header)</span></div><div class="line">            response.append(<span class="string">"Content-Type:text/html;charset=utf-8"</span>).append(CRLF);</div><div class="line">            response.append(<span class="string">"Server:BWS/1.0"</span>).append(CRLF);</div><div class="line">            response.append(<span class="string">"Date:"</span>).append(<span class="keyword">new</span> Date()).append(CRLF);</div><div class="line">            response.append(<span class="string">"Content-Length:"</span>).append(responseContent.toString().getBytes().length).append(CRLF);</div><div class="line">            response.append(CRLF);</div><div class="line">            <span class="comment">// 3. 响应正文(Response Content)</span></div><div class="line">            response.append(responseContent);</div><div class="line"></div><div class="line">            <span class="comment">// 输出流</span></div><div class="line">            BufferedWriter bw = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(client.getOutputStream()));</div><div class="line">            bw.write(response.toString());</div><div class="line">            bw.flush();</div><div class="line">            bw.close();</div><div class="line"></div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 停止服务器</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="手写HttpServer服务器之封装Response"><a href="#手写HttpServer服务器之封装Response" class="headerlink" title="手写HttpServer服务器之封装Response"></a>手写HttpServer服务器之封装Response</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 响应对象的封装</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Response</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 两个常量</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CRLF = <span class="string">"\r\n"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String BLANK = <span class="string">" "</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> BufferedWriter bw;</div><div class="line"></div><div class="line">    <span class="comment">// 正文</span></div><div class="line">    <span class="keyword">private</span> StringBuilder content;</div><div class="line"></div><div class="line">    <span class="comment">// 存储头信息</span></div><div class="line">    <span class="keyword">private</span> StringBuilder headerInfo;</div><div class="line"></div><div class="line">    <span class="comment">// 存储正文长度</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> len = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Response</span><span class="params">()</span> </span>&#123;</div><div class="line">        headerInfo = <span class="keyword">new</span> StringBuilder();</div><div class="line">        content = <span class="keyword">new</span> StringBuilder();</div><div class="line">        len = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Response</span><span class="params">(OutputStream os)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>();</div><div class="line">        bw = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(os));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Response</span><span class="params">(Socket client)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            bw = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(client.getOutputStream()));</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            headerInfo = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 构建正文</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">print</span><span class="params">(String info)</span> </span>&#123;</div><div class="line">        content.append(info);</div><div class="line">        len += info.getBytes().length;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 构建正文 + 回车</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">println</span><span class="params">(String info)</span> </span>&#123;</div><div class="line">        content.append(info).append(CRLF);</div><div class="line">        len += info.getBytes().length;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 构建响应头</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createHeadInfo</span><span class="params">(<span class="keyword">int</span> code)</span> </span>&#123;</div><div class="line">        <span class="comment">// 1. HTTP协议版本，状态代码，描述</span></div><div class="line">        headerInfo.append(<span class="string">"HTTP/1.1"</span>).append(BLANK).append(code).append(BLANK);</div><div class="line">        <span class="keyword">switch</span> (code) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="number">200</span>:</div><div class="line">                headerInfo.append(<span class="string">"OK"</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">404</span>:</div><div class="line">                headerInfo.append(<span class="string">"Not Found"</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">500</span>:</div><div class="line">                headerInfo.append(<span class="string">"Internal Server Error"</span>);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        headerInfo.append(CRLF);</div><div class="line">        <span class="comment">// 2. 响应头(Response Header)</span></div><div class="line">        headerInfo.append(<span class="string">"Content-Type:text/html;charset=utf-8"</span>).append(CRLF);</div><div class="line">        headerInfo.append(<span class="string">"Server:BWS/1.0"</span>).append(CRLF);</div><div class="line">        headerInfo.append(<span class="string">"Date:"</span>).append(<span class="keyword">new</span> Date()).append(CRLF);</div><div class="line">        headerInfo.append(<span class="string">"Content-Length:"</span>).append(len).append(CRLF);</div><div class="line">        headerInfo.append(CRLF);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pushToClient</span><span class="params">(<span class="keyword">int</span> code)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == headerInfo) &#123;</div><div class="line">            code = <span class="number">500</span>;</div><div class="line">        &#125;</div><div class="line">        createHeadInfo(code);</div><div class="line">        <span class="comment">// 1. 头信息 + 分隔符</span></div><div class="line">        bw.append(headerInfo.toString());</div><div class="line">        <span class="comment">// 2. 正文</span></div><div class="line">        bw.append(content.toString());</div><div class="line">        bw.flush();</div><div class="line">        <span class="keyword">this</span>.close();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</div><div class="line">        CloseUtil.closeAll(bw);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server4</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> ServerSocket server;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Server4 server = <span class="keyword">new</span> Server4();</div><div class="line">        server.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 启动方法</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            server = <span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</div><div class="line">            <span class="keyword">this</span>.receive();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 接收客户端</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Socket client = server.accept();</div><div class="line"></div><div class="line">            Response rep = <span class="keyword">new</span> Response(client);</div><div class="line">            rep.println(<span class="string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;第一个html&lt;/title&gt;&lt;/head&gt;&lt;body&gt;"</span>);</div><div class="line">            rep.println(<span class="string">"Hello test &lt;/body&gt;&lt;/html&gt;"</span>);</div><div class="line">            rep.pushToClient(<span class="number">404</span>);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="手写HttpServer服务器之封装Request（method、url）"><a href="#手写HttpServer服务器之封装Request（method、url）" class="headerlink" title="手写HttpServer服务器之封装Request（method、url）"></a>手写HttpServer服务器之封装Request（method、url）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server5</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> ServerSocket server;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Server5 server = <span class="keyword">new</span> Server5();</div><div class="line">        server.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 启动方法</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            server = <span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</div><div class="line">            <span class="keyword">this</span>.receive();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 接收客户端</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Socket client = server.accept();</div><div class="line"></div><div class="line">            Request request = <span class="keyword">new</span> Request(client.getInputStream());</div><div class="line">            String name = request.getParameter(<span class="string">"uname"</span>);</div><div class="line"></div><div class="line">            Response response = <span class="keyword">new</span> Response(client);</div><div class="line"></div><div class="line">            response.println(<span class="string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;第一个html&lt;/title&gt;&lt;/head&gt;&lt;body&gt;"</span>);</div><div class="line">            response.println(<span class="string">"欢迎 "</span>);</div><div class="line">            response.println(<span class="string">"&lt;span style='color:red;'&gt;"</span> + name + <span class="string">"&lt;/span&gt;"</span>);</div><div class="line">            response.println(<span class="string">"先生"</span>);</div><div class="line">            response.println(<span class="string">"&lt;/body&gt;&lt;/html&gt;"</span>);</div><div class="line">            response.pushToClient(<span class="number">200</span>);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="手写HttpServer服务器之封装Request（储存参数、处理中文）"><a href="#手写HttpServer服务器之封装Request（储存参数、处理中文）" class="headerlink" title="手写HttpServer服务器之封装Request（储存参数、处理中文）"></a>手写HttpServer服务器之封装Request（储存参数、处理中文）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.yhy.server;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</div><div class="line"><span class="keyword">import</span> java.net.URLDecoder;</div><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 封装request</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 请求方式</span></div><div class="line">    <span class="keyword">private</span> String method;</div><div class="line"></div><div class="line">    <span class="comment">// 请求资源</span></div><div class="line">    <span class="keyword">private</span> String url;</div><div class="line"></div><div class="line">    <span class="comment">// 请求参数</span></div><div class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;String&gt;&gt; paramsMap;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CRLF = <span class="string">"\r\n"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> InputStream is;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String requestInfo;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</div><div class="line">        method = <span class="string">""</span>;</div><div class="line">        url = <span class="string">""</span>;</div><div class="line">        paramsMap = <span class="keyword">new</span> HashMap&lt;String, List&lt;String&gt;&gt;();</div><div class="line">        requestInfo = <span class="string">""</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Request</span><span class="params">(InputStream input)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>();</div><div class="line">        <span class="keyword">this</span>.is = input;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">20480</span>];</div><div class="line">            <span class="keyword">int</span> len = <span class="number">0</span>;</div><div class="line">            len = is.read(data);</div><div class="line">            requestInfo = <span class="keyword">new</span> String(data, <span class="number">0</span>, len);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 分析头信息</span></div><div class="line">        parseRequestInfo();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 分析请求信息</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseRequestInfo</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == requestInfo || requestInfo.trim().equals(<span class="string">""</span>)) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 1. 从信息的首行分析出: 请求方式, 请求路径 请求参数 (get可能存在)</span></div><div class="line"><span class="comment">         * 如: GET /index.html?name=yhy&amp;pwd=123</span></div><div class="line"><span class="comment">         *</span></div><div class="line"><span class="comment">         * 2. 如果为post方式,请求参数可能在最后的正文中</span></div><div class="line"><span class="comment">         */</span></div><div class="line"></div><div class="line">        String paramString = <span class="string">""</span>; <span class="comment">// 接收请求参数</span></div><div class="line"></div><div class="line">        <span class="comment">// 1. 获取请求方式</span></div><div class="line">        String firstLine = requestInfo.substring(<span class="number">0</span>, requestInfo.indexOf(CRLF));</div><div class="line">        <span class="keyword">int</span> index = requestInfo.indexOf(<span class="string">"/"</span>);</div><div class="line">        <span class="keyword">this</span>.method = firstLine.substring(<span class="number">0</span>, index).trim();</div><div class="line"></div><div class="line">        String urlStr = firstLine.substring(index, firstLine.indexOf(<span class="string">"HTTP/"</span>)).trim();</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.method.equalsIgnoreCase(<span class="string">"post"</span>)) &#123;</div><div class="line">            <span class="keyword">this</span>.url = urlStr;</div><div class="line">            paramString = requestInfo.substring(requestInfo.lastIndexOf(CRLF)).trim();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.method.equalsIgnoreCase(<span class="string">"get"</span>)) &#123;</div><div class="line">            <span class="keyword">if</span> (urlStr.contains(<span class="string">"?"</span>)) &#123; <span class="comment">// 是否存在参数</span></div><div class="line">                String[] urlArray = urlStr.split(<span class="string">"\\?"</span>);</div><div class="line">                <span class="keyword">this</span>.url = urlArray[<span class="number">0</span>];</div><div class="line">                paramString = urlArray[<span class="number">1</span>];</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">this</span>.url = urlStr;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// 不存在请求参数</span></div><div class="line">        <span class="keyword">if</span> (paramString.equals(<span class="string">""</span>)) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 请求参数封装到Map中</span></div><div class="line">        parseParams(paramString);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseParams</span><span class="params">(String paramString)</span> </span>&#123;</div><div class="line">        <span class="comment">//分割, 将字符串转成数组</span></div><div class="line">        StringTokenizer token = <span class="keyword">new</span> StringTokenizer(paramString, <span class="string">"&amp;"</span>);</div><div class="line">        <span class="keyword">while</span> (token.hasMoreTokens()) &#123;</div><div class="line">            String keyValue = token.nextToken();</div><div class="line">            String[] keyValues = keyValue.split(<span class="string">"="</span>);</div><div class="line">            <span class="keyword">if</span> (keyValues.length == <span class="number">1</span>) &#123;</div><div class="line">                keyValues = Arrays.copyOf(keyValues, <span class="number">2</span>);</div><div class="line">                keyValues[<span class="number">1</span>] = <span class="keyword">null</span>;</div><div class="line">            &#125;</div><div class="line">            String key = keyValues[<span class="number">0</span>].trim();</div><div class="line">            String value = <span class="keyword">null</span> == keyValues[<span class="number">1</span>] ? <span class="keyword">null</span> : decode(keyValues[<span class="number">1</span>].trim(), <span class="string">"utf-8"</span>);</div><div class="line">            <span class="comment">// 转换成Map 分拣</span></div><div class="line">            <span class="keyword">if</span> (!paramsMap.containsKey(key)) &#123;</div><div class="line">                paramsMap.put(key, <span class="keyword">new</span> ArrayList&lt;String&gt;());</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            List&lt;String&gt; values = paramsMap.get(key);</div><div class="line">            values.add(value);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> String[] getParameterValues(String name) &#123;</div><div class="line">        List&lt;String&gt; values = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">if</span> ((values = paramsMap.get(name)) == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> values.toArray(<span class="keyword">new</span> String[<span class="number">0</span>]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 根据页面的name 获取对应的值</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getParameter</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        String[] values = getParameterValues(name);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == values) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> values[<span class="number">0</span>];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 解决中文问题</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">decode</span><span class="params">(String value, String code)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> URLDecoder.decode(value, code);</div><div class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 测试</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        String params = <span class="string">"name=&amp;pwd=123&amp;fav=0&amp;fav=2"</span>;</div><div class="line">        <span class="keyword">new</span> Request().parseParams(params);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUrl</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> url;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="手写HttpServer服务器之封装分发器"><a href="#手写HttpServer服务器之封装分发器" class="headerlink" title="手写HttpServer服务器之封装分发器"></a>手写HttpServer服务器之封装分发器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 一个请求与响应就一个此对象</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dispatcher</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Socket client;</div><div class="line">    <span class="keyword">private</span> Request req;</div><div class="line">    <span class="keyword">private</span> Response rep;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code = <span class="number">200</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dispatcher</span><span class="params">(Socket client)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.client = client;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            req = <span class="keyword">new</span> Request(client.getInputStream());</div><div class="line">            rep = <span class="keyword">new</span> Response(client.getOutputStream());</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            <span class="comment">//e.printStackTrace();</span></div><div class="line">            code = <span class="number">500</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        Servlet servlet = <span class="keyword">new</span> Servlet();</div><div class="line">        servlet.service(req, rep);</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            rep.pushToClient(code); <span class="comment">// 推送到客户端</span></div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            <span class="comment">//e.printStackTrace();</span></div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            CloseUtil.closeAll(client);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 请求并响应</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server6</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> ServerSocket server;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isShutDown = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Server6 server = <span class="keyword">new</span> Server6();</div><div class="line">        server.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 启动方法</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.start(<span class="number">8888</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 指定端口的启动</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> port</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(<span class="keyword">int</span> port)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            server = <span class="keyword">new</span> ServerSocket(port);</div><div class="line">            <span class="keyword">this</span>.receive();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 接收客户端</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">while</span> (!isShutDown) &#123;</div><div class="line">                <span class="keyword">new</span> Thread(<span class="keyword">new</span> Dispatcher(server.accept())).start();</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">            stop();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 停止服务器</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</div><div class="line">        isShutDown = <span class="keyword">true</span>;</div><div class="line">        CloseUtil.closeAll(server);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Servlet</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(Request req, Response rep)</span> </span>&#123;</div><div class="line">        rep.println(<span class="string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;第一个html&lt;/title&gt;&lt;/head&gt;&lt;body&gt;"</span>);</div><div class="line">        rep.println(<span class="string">"欢迎 "</span>);</div><div class="line">        rep.println(<span class="string">"&lt;span style='color:red;'&gt;"</span> + req.getParameter(<span class="string">"uname"</span>) + <span class="string">"&lt;/span&gt;"</span>);</div><div class="line">        rep.println(<span class="string">"先生"</span>);</div><div class="line">        rep.println(<span class="string">"&lt;/body&gt;&lt;/html&gt;"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://www.yhyecho.com/2016/08/30/Java从头学之Net/" data-title="Java从头学之Net | echo home" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/09/09/Java从头学之设计模式/" title="Java从头学之设计模式">
  <strong>上一篇：</strong><br/>
  <span>
  Java从头学之设计模式</span>
</a>
</div>


<div class="next">
<a href="/2016/08/28/Java从头学之JDBC/"  title="Java从头学之JDBC">
 <strong>下一篇：</strong><br/> 
 <span>Java从头学之JDBC
</span>
</a>
</div>

</nav>

	


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#网络编程"><span class="toc-number">1.</span> <span class="toc-text">网络编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#一-网络相关概念"><span class="toc-number">1.0.1.</span> <span class="toc-text">一. 网络相关概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#一-java中相关类"><span class="toc-number">1.0.2.</span> <span class="toc-text">一. java中相关类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（InetAddress、InetSocketAddress）"><span class="toc-number">1.0.3.</span> <span class="toc-text">网络编程（InetAddress、InetSocketAddress）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（URL、爬虫原理）"><span class="toc-number">1.0.4.</span> <span class="toc-text">网络编程（URL、爬虫原理）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（UDP编程、原理）"><span class="toc-number">1.0.5.</span> <span class="toc-text">网络编程（UDP编程、原理）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（UDP编程、发送类型、CS与BS区别）"><span class="toc-number">1.0.6.</span> <span class="toc-text">网络编程（UDP编程、发送类型、CS与BS区别）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（TCP、Socket通信、原理）"><span class="toc-number">1.0.7.</span> <span class="toc-text">网络编程（TCP、Socket通信、原理）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（TCP、Socket通信、多个客户端、聊天室原理）"><span class="toc-number">1.0.8.</span> <span class="toc-text">网络编程（TCP、Socket通信、多个客户端、聊天室原理）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（TCP、Socket通信、聊天室、客户端多线程）"><span class="toc-number">1.0.9.</span> <span class="toc-text">网络编程（TCP、Socket通信、聊天室、客户端多线程）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（TCP、Socket通信、聊天室、群聊）"><span class="toc-number">1.0.10.</span> <span class="toc-text">网络编程（TCP、Socket通信、聊天室、群聊）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#网络编程（TCP、Socket通信、聊天室、私聊实现）"><span class="toc-number">1.0.11.</span> <span class="toc-text">网络编程（TCP、Socket通信、聊天室、私聊实现）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之Socket入门"><span class="toc-number">1.0.12.</span> <span class="toc-text">手写HttpServer服务器之Socket入门</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之HTML"><span class="toc-number">1.0.13.</span> <span class="toc-text">手写HttpServer服务器之HTML</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之Http协议"><span class="toc-number">1.0.14.</span> <span class="toc-text">手写HttpServer服务器之Http协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之封装Response"><span class="toc-number">1.0.15.</span> <span class="toc-text">手写HttpServer服务器之封装Response</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之封装Request（method、url）"><span class="toc-number">1.0.16.</span> <span class="toc-text">手写HttpServer服务器之封装Request（method、url）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之封装Request（储存参数、处理中文）"><span class="toc-number">1.0.17.</span> <span class="toc-text">手写HttpServer服务器之封装Request（储存参数、处理中文）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写HttpServer服务器之封装分发器"><span class="toc-number">1.0.18.</span> <span class="toc-text">手写HttpServer服务器之封装分发器</span></a></li></ol></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="yhyecho" data-theme="medium"></div>
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>



</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<section class="info">
		<p> Hello, I&#39;m Echo  <br/>
			This is my blog, Welcome</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/yhyecho" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="yhyecho">yhyecho</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
